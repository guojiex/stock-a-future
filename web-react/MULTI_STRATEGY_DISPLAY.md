# å¤šç­–ç•¥å›æµ‹å±•ç¤ºåŠŸèƒ½

## æ¦‚è¿°

å›æµ‹é¡µé¢ç°åœ¨å®Œæ•´æ”¯æŒå¤šç­–ç•¥å›æµ‹ç»“æœå±•ç¤ºï¼Œå¯ä»¥åŒæ—¶æŸ¥çœ‹å¤šä¸ªç­–ç•¥çš„è¡¨ç°å¯¹æ¯”å’Œç»„åˆæ•´ä½“æ•ˆæœã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸ“Š 1. åˆ†å±‚å±•ç¤º

å›æµ‹ç»“æœæŒ‰ä»¥ä¸‹å±‚æ¬¡å±•ç¤ºï¼š

#### ç¬¬ä¸€å±‚ï¼šç»„åˆæ•´ä½“è¡¨ç°
- æ˜¾ç¤ºæ‰€æœ‰ç­–ç•¥ç»„åˆåçš„æ•´ä½“æŒ‡æ ‡
- åŒ…æ‹¬æ€»æ”¶ç›Šç‡ã€å¹´åŒ–æ”¶ç›Šã€æœ€å¤§å›æ’¤ã€å¤æ™®æ¯”ç‡ç­‰
- æ ‡é¢˜ï¼š**ğŸ“Š ç»„åˆæ•´ä½“è¡¨ç°**

#### ç¬¬äºŒå±‚ï¼šå„ç­–ç•¥è¡¨ç°å¯¹æ¯”
- å½“é€‰æ‹©å¤šä¸ªç­–ç•¥ï¼ˆ2ä¸ªæˆ–ä»¥ä¸Šï¼‰æ—¶æ˜¾ç¤º
- æ¯ä¸ªç­–ç•¥ç‹¬ç«‹å±•ç¤ºå…¶æ€§èƒ½æŒ‡æ ‡
- åŒ…å«ç­–ç•¥åç§°æ ‡é¢˜
- æ ‡é¢˜ï¼š**ğŸ¯ å„ç­–ç•¥è¡¨ç°å¯¹æ¯”**

#### ç¬¬ä¸‰å±‚ï¼šå•ç­–ç•¥è¡¨ç°
- å½“åªé€‰æ‹©1ä¸ªç­–ç•¥æ—¶æ˜¾ç¤º
- ç›´æ¥å±•ç¤ºè¯¥ç­–ç•¥çš„æ€§èƒ½æŒ‡æ ‡
- æ ‡é¢˜ï¼š**ğŸ“Š ç­–ç•¥è¡¨ç°**

### ğŸ“ˆ 2. ç»„åˆæƒç›Šæ›²çº¿

- å±•ç¤ºæ‰€æœ‰ç­–ç•¥ç»„åˆåçš„æ•´ä½“æƒç›Šæ›²çº¿
- åŒ…å«ç»„åˆä»·å€¼ã€åŸºå‡†ä»·å€¼ï¼ˆå¦‚æœæœ‰ï¼‰ã€ç°é‡‘ã€æŒä»“ç­‰
- æ ‡é¢˜ï¼š**ğŸ“ˆ ç»„åˆæƒç›Šæ›²çº¿**

### ğŸ“‹ 3. äº¤æ˜“è®°å½•ä¸ç­–ç•¥å…³è”

äº¤æ˜“è®°å½•è¡¨æ ¼æ–°å¢åŠŸèƒ½ï¼š
- **ç­–ç•¥åˆ—**ï¼šå½“æœ‰å¤šä¸ªç­–ç•¥æ—¶ï¼Œæ˜¾ç¤ºç­–ç•¥åˆ—
- **ç­–ç•¥æ ‡ç­¾**ï¼šæ¯ç¬”äº¤æ˜“æ˜¾ç¤ºå…¶æ‰€å±ç­–ç•¥çš„åç§°
- **é¢œè‰²åŒºåˆ†**ï¼šä½¿ç”¨ Chip ç»„ä»¶æ ‡è¯†ä¸åŒç­–ç•¥
- è‡ªåŠ¨éšè—ï¼šåªæœ‰1ä¸ªç­–ç•¥æ—¶ï¼Œç­–ç•¥åˆ—è‡ªåŠ¨éšè—

## æ•°æ®ç»“æ„

### åç«¯ API å“åº”

```json
{
  "success": true,
  "data": {
    "backtest_id": "uuid",
    
    // ç»„åˆæ•´ä½“æŒ‡æ ‡ï¼ˆå¯é€‰ï¼‰
    "combined_metrics": {
      "total_return": 0.25,
      "annual_return": 0.30,
      "max_drawdown": -0.12,
      "sharpe_ratio": 2.1,
      "win_rate": 0.65,
      "total_trades": 150
    },
    
    // å„ç­–ç•¥ç‹¬ç«‹æŒ‡æ ‡æ•°ç»„
    "performance": [
      {
        "strategy_id": "strategy-1-id",
        "strategy_name": "MACDé‡‘å‰ç­–ç•¥",
        "total_return": 0.20,
        "annual_return": 0.24,
        "max_drawdown": -0.10,
        "sharpe_ratio": 1.8,
        "win_rate": 0.60,
        "total_trades": 50
      },
      {
        "strategy_id": "strategy-2-id",
        "strategy_name": "åŒå‡çº¿ç­–ç•¥",
        "total_return": 0.18,
        "annual_return": 0.22,
        "max_drawdown": -0.08,
        "sharpe_ratio": 1.6,
        "win_rate": 0.62,
        "total_trades": 45
      },
      // ... æ›´å¤šç­–ç•¥
    ],
    
    // ç­–ç•¥ä¿¡æ¯æ•°ç»„
    "strategies": [
      {
        "id": "strategy-1-id",
        "name": "MACDé‡‘å‰ç­–ç•¥",
        "description": "..."
      },
      {
        "id": "strategy-2-id",
        "name": "åŒå‡çº¿ç­–ç•¥",
        "description": "..."
      },
      // ... æ›´å¤šç­–ç•¥
    ],
    
    // ç»„åˆæƒç›Šæ›²çº¿
    "equity_curve": [
      {
        "date": "2024-01-01",
        "portfolio_value": 1050000,
        "benchmark_value": 1020000,
        "cash": 200000,
        "holdings": 850000
      },
      // ... æ›´å¤šæ•°æ®ç‚¹
    ],
    
    // äº¤æ˜“è®°å½•ï¼ˆåŒ…å«ç­–ç•¥IDï¼‰
    "trades": [
      {
        "id": "trade-1",
        "strategy_id": "strategy-1-id",  // å…³è”ç­–ç•¥
        "symbol": "000001.SZ",
        "side": "buy",
        "quantity": 1000,
        "price": 15.50,
        "commission": 4.65,
        "timestamp": "2024-01-01T09:30:00Z"
      },
      // ... æ›´å¤šäº¤æ˜“
    ]
  }
}
```

## UI å±•ç¤ºé€»è¾‘

### æ¡ä»¶æ¸²æŸ“è§„åˆ™

```typescript
// 1. ç»„åˆæ•´ä½“è¡¨ç°
{results.combined_metrics && (
  <Paper>ç»„åˆæ•´ä½“è¡¨ç°</Paper>
)}

// 2. å¤šç­–ç•¥å¯¹æ¯”ï¼ˆ2ä¸ªæˆ–ä»¥ä¸Šï¼‰
{results.performance?.length > 1 && (
  <Paper>
    {results.performance.map((perf, index) => (
      <Box key={index}>
        <Typography>{strategies[index].name}</Typography>
        {renderMetrics(perf)}
      </Box>
    ))}
  </Paper>
)}

// 3. å•ç­–ç•¥è¡¨ç°ï¼ˆåªæœ‰1ä¸ªï¼‰
{results.performance?.length === 1 && (
  <Paper>
    {renderMetrics(results.performance[0])}
  </Paper>
)}

// 4. ç»„åˆæƒç›Šæ›²çº¿
{results.equity_curve?.length > 0 && (
  <Paper>
    <EquityCurveChart data={results.equity_curve} />
  </Paper>
)}

// 5. äº¤æ˜“è®°å½•ï¼ˆå¸¦ç­–ç•¥ä¿¡æ¯ï¼‰
{results.trades?.length > 0 && (
  <Paper>
    <TradesTable 
      trades={results.trades}
      strategies={results.strategies}
    />
  </Paper>
)}
```

### äº¤æ˜“è¡¨æ ¼ç­–ç•¥åˆ—

```typescript
// ç­–ç•¥åˆ—åªåœ¨å¤šç­–ç•¥æ—¶æ˜¾ç¤º
{strategies?.length > 1 && (
  <TableCell>
    <Chip label={strategyName} />
  </TableCell>
)}
```

## ç¤ºä¾‹åœºæ™¯

### åœºæ™¯ 1ï¼šé€‰æ‹© 4 ä¸ªç­–ç•¥

**æ˜¾ç¤ºå†…å®¹**ï¼š
1. âœ… ç»„åˆæ•´ä½“è¡¨ç°å¡ç‰‡
2. âœ… å„ç­–ç•¥è¡¨ç°å¯¹æ¯”å¡ç‰‡ï¼ˆ4ä¸ªç­–ç•¥åˆ†åˆ«å±•ç¤ºï¼‰
3. âœ… ç»„åˆæƒç›Šæ›²çº¿å›¾
4. âœ… äº¤æ˜“è®°å½•è¡¨ï¼ˆå¸¦ç­–ç•¥åˆ—ï¼‰

**å¸ƒå±€**ï¼š
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š ç»„åˆæ•´ä½“è¡¨ç°                 â”‚
â”‚ [6ä¸ªæ€§èƒ½æŒ‡æ ‡å¡ç‰‡]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¯ å„ç­–ç•¥è¡¨ç°å¯¹æ¯”               â”‚
â”‚                                 â”‚
â”‚ MACDé‡‘å‰ç­–ç•¥                    â”‚
â”‚ [6ä¸ªæ€§èƒ½æŒ‡æ ‡å¡ç‰‡]               â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ åŒå‡çº¿ç­–ç•¥                      â”‚
â”‚ [6ä¸ªæ€§èƒ½æŒ‡æ ‡å¡ç‰‡]               â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ å¸ƒæ—å¸¦ç­–ç•¥                      â”‚
â”‚ [6ä¸ªæ€§èƒ½æŒ‡æ ‡å¡ç‰‡]               â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚ RSIè¶…ä¹°è¶…å–ç­–ç•¥                 â”‚
â”‚ [6ä¸ªæ€§èƒ½æŒ‡æ ‡å¡ç‰‡]               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ˆ ç»„åˆæƒç›Šæ›²çº¿                 â”‚
â”‚ [ç»Ÿè®¡ä¿¡æ¯ + æŠ˜çº¿å›¾]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ äº¤æ˜“è®°å½•                     â”‚
â”‚ æ—¶é—´ | ä»£ç  | ç­–ç•¥ | æ–¹å‘ | ... â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åœºæ™¯ 2ï¼šé€‰æ‹© 1 ä¸ªç­–ç•¥

**æ˜¾ç¤ºå†…å®¹**ï¼š
1. âœ… ç­–ç•¥è¡¨ç°å¡ç‰‡ï¼ˆå•ç­–ç•¥ï¼‰
2. âœ… ç»„åˆæƒç›Šæ›²çº¿å›¾
3. âœ… äº¤æ˜“è®°å½•è¡¨ï¼ˆæ— ç­–ç•¥åˆ—ï¼‰

### åœºæ™¯ 3ï¼šåç«¯æœªè¿”å› combined_metrics

- è‡ªåŠ¨è·³è¿‡ç»„åˆæ•´ä½“è¡¨ç°å¡ç‰‡
- ç›´æ¥æ˜¾ç¤ºå„ç­–ç•¥è¡¨ç°å¯¹æ¯”

## ä»£ç ä¿®æ”¹

### æ–‡ä»¶ï¼š`web-react/src/pages/BacktestPage.tsx`

**ä¿®æ”¹å†…å®¹**ï¼š
1. å°†å•ä¸ª Paper æ‹†åˆ†ä¸ºå¤šä¸ªç‹¬ç«‹çš„ Paper
2. æ·»åŠ æ¡ä»¶æ¸²æŸ“é€»è¾‘
3. æ”¯æŒ `combined_metrics` å’Œ `performance` æ•°ç»„
4. ä¼ é€’ `strategies` ç»™ TradesTable

### æ–‡ä»¶ï¼š`web-react/src/components/TradesTable.tsx`

**ä¿®æ”¹å†…å®¹**ï¼š
1. æ·»åŠ  `strategies` å¯é€‰å±æ€§
2. åˆ›å»ºç­–ç•¥IDåˆ°åç§°çš„æ˜ å°„
3. æ·»åŠ ç­–ç•¥åˆ—ï¼ˆå¤šç­–ç•¥æ—¶æ˜¾ç¤ºï¼‰
4. ä½¿ç”¨ Chip ç»„ä»¶å±•ç¤ºç­–ç•¥åç§°

## æ€§èƒ½ä¼˜åŒ–

### ç­–ç•¥æ˜ å°„

ä½¿ç”¨ `useMemo` ç¼“å­˜ç­–ç•¥IDåˆ°åç§°çš„æ˜ å°„ï¼š

```typescript
const strategyMap = React.useMemo(() => {
  const map: Record<string, string> = {};
  if (strategies) {
    strategies.forEach(s => {
      map[s.id] = s.name;
    });
  }
  return map;
}, [strategies]);
```

### æ¡ä»¶æ¸²æŸ“

- åªåœ¨æœ‰æ•°æ®æ—¶æ¸²æŸ“ç»„ä»¶
- é¿å…ç©ºæ•°æ®çš„ä¸å¿…è¦æ¸²æŸ“
- ä½¿ç”¨ `&&` å’Œ `?` è¿›è¡Œå®‰å…¨æ£€æŸ¥

## ç”¨æˆ·ä½“éªŒ

### ä¼˜åŠ¿

1. **æ¸…æ™°çš„å±‚æ¬¡ç»“æ„**ï¼šç»„åˆ â†’ å„ç­–ç•¥ â†’ è¯¦ç»†æ•°æ®
2. **çµæ´»çš„å±•ç¤º**ï¼šè‡ªåŠ¨é€‚é…å•ç­–ç•¥å’Œå¤šç­–ç•¥åœºæ™¯
3. **ç­–ç•¥å½’å±æ¸…æ™°**ï¼šæ¯ç¬”äº¤æ˜“éƒ½èƒ½è¿½æº¯åˆ°å…·ä½“ç­–ç•¥
4. **å¯¹æ¯”ä¾¿æ·**ï¼šå¤šä¸ªç­–ç•¥æ€§èƒ½ä¸€ç›®äº†ç„¶

### æ”¹è¿›ç‚¹

- âœ… è§£å†³äº†"é€‰æ‹©4ä¸ªç­–ç•¥åªæ˜¾ç¤º1ä¸ª"çš„é—®é¢˜
- âœ… æä¾›äº†å®Œæ•´çš„å¤šç­–ç•¥å¯¹æ¯”è§†å›¾
- âœ… äº¤æ˜“è®°å½•ä¸ç­–ç•¥å…³è”æ¸…æ™°
- âœ… æ”¯æŒç»„åˆæ•´ä½“å’Œå•ç­–ç•¥è¡¨ç°

## æœªæ¥å¢å¼º

### å¯è§†åŒ–å¢å¼º

1. **ç­–ç•¥æƒç›Šæ›²çº¿å¯¹æ¯”**ï¼š
   - åœ¨åŒä¸€å›¾è¡¨ä¸­å±•ç¤ºå¤šæ¡ç­–ç•¥æ›²çº¿
   - ä¸åŒé¢œè‰²åŒºåˆ†ä¸åŒç­–ç•¥
   - æ”¯æŒæ˜¾ç¤º/éšè—ç‰¹å®šç­–ç•¥

2. **ç­–ç•¥è´¡çŒ®åˆ†æ**ï¼š
   - é¥¼å›¾å±•ç¤ºå„ç­–ç•¥å¯¹æ€»æ”¶ç›Šçš„è´¡çŒ®
   - æŸ±çŠ¶å›¾å¯¹æ¯”å„ç­–ç•¥çš„å¤æ™®æ¯”ç‡

3. **ç­–ç•¥ç›¸å…³æ€§åˆ†æ**ï¼š
   - çƒ­åŠ›å›¾å±•ç¤ºç­–ç•¥ä¹‹é—´çš„ç›¸å…³æ€§
   - å¸®åŠ©ä¼˜åŒ–ç­–ç•¥ç»„åˆ

### äº¤äº’å¢å¼º

1. **ç­–ç•¥ç­›é€‰**ï¼š
   - äº¤æ˜“è®°å½•æ”¯æŒæŒ‰ç­–ç•¥ç­›é€‰
   - æƒç›Šæ›²çº¿æ”¯æŒé€‰æ‹©æ˜¾ç¤ºçš„ç­–ç•¥

2. **ç­–ç•¥æƒé‡è°ƒæ•´**ï¼š
   - æ¨¡æ‹Ÿä¸åŒç­–ç•¥æƒé‡é…ç½®
   - å®æ—¶é¢„è§ˆç»„åˆæ•ˆæœ

## æµ‹è¯•å»ºè®®

### åŠŸèƒ½æµ‹è¯•

1. **å•ç­–ç•¥åœºæ™¯**ï¼š
   - é€‰æ‹©1ä¸ªç­–ç•¥
   - éªŒè¯æ˜¾ç¤º"ç­–ç•¥è¡¨ç°"è€Œé"å„ç­–ç•¥è¡¨ç°å¯¹æ¯”"
   - éªŒè¯äº¤æ˜“è¡¨æ ¼æ— ç­–ç•¥åˆ—

2. **å¤šç­–ç•¥åœºæ™¯**ï¼š
   - é€‰æ‹©2-5ä¸ªç­–ç•¥
   - éªŒè¯æ˜¾ç¤ºæ‰€æœ‰ç­–ç•¥çš„æ€§èƒ½æŒ‡æ ‡
   - éªŒè¯äº¤æ˜“è¡¨æ ¼æ˜¾ç¤ºç­–ç•¥åˆ—
   - éªŒè¯ç­–ç•¥åç§°æ­£ç¡®æ˜ å°„

3. **è¾¹ç•Œæ¡ä»¶**ï¼š
   - æ—  combined_metrics
   - æ—  strategies æ•°ç»„
   - ç­–ç•¥IDä¸äº¤æ˜“è®°å½•ä¸åŒ¹é…

### æ•°æ®éªŒè¯

- å„ç­–ç•¥æŒ‡æ ‡æ€»å’Œåº”æ¥è¿‘ç»„åˆæŒ‡æ ‡
- äº¤æ˜“è®°å½•çš„ç­–ç•¥IDåº”å­˜åœ¨äº strategies æ•°ç»„ä¸­
- ç­–ç•¥æ•°é‡åº”ä¸ selectedStrategyIds ä¸€è‡´

## ç›¸å…³æ–‡ä»¶

- `web-react/src/pages/BacktestPage.tsx` - ä¸»é¡µé¢é€»è¾‘
- `web-react/src/components/TradesTable.tsx` - äº¤æ˜“è®°å½•è¡¨æ ¼
- `web-react/src/components/EquityCurveChart.tsx` - æƒç›Šæ›²çº¿å›¾è¡¨

## æ€»ç»“

âœ… **å®Œæˆçš„åŠŸèƒ½**:
- ç»„åˆæ•´ä½“è¡¨ç°å±•ç¤º
- å„ç­–ç•¥ç‹¬ç«‹è¡¨ç°å¯¹æ¯”
- äº¤æ˜“è®°å½•ç­–ç•¥å…³è”
- è‡ªåŠ¨é€‚é…å•/å¤šç­–ç•¥åœºæ™¯

ğŸ‰ **ç°åœ¨å¯ä»¥æ¸…æ™°åœ°çœ‹åˆ°æ‰€æœ‰4ä¸ªç­–ç•¥çš„è¡¨ç°äº†ï¼**

