# 快速回测功能 - 股票详情页集成

## 📋 功能说明

在股票详情页面顶部添加了"快速回测"按钮，用户可以直接从股票页面跳转到回测页面，并自动填充当前股票的信息。

## ✅ 完全参考网页版实现

参考了网页版 `web/static/index.html` 中的快速回测按钮实现：

```html
<!-- 网页版实现 -->
<button id="quickBacktestBtn" class="btn btn-success btn-small" 
        title="使用当前股票快速开始回测">
    🚀 快速回测
</button>
```

## 🎯 功能特点

### 1. 按钮位置
- **位置**: 股票详情页面顶部导航栏
- **样式**: 绿色按钮，带火箭图标 🚀
- **大小**: small（与页面其他按钮协调）

### 2. 自动填充信息
点击"快速回测"后，系统会自动：

1. **回测名称**: 自动生成 `{股票名称} - 回测分析 {日期}`
   - 例如: "平安银行 - 回测分析 2024-10-14"

2. **股票代码**: 自动填充当前股票代码
   - 例如: "000001.SZ"

3. **时间范围**: 默认选择最近1年
   - 开始日期: 1年前
   - 结束日期: 今天

4. **跳转页面**: 自动导航到 `/backtest` 回测配置页面

### 3. 用户提示
- 使用Snackbar显示操作提示
- 提示内容: "已切换到回测页面，股票 {代码} 已预填充"

## 🔧 技术实现

### 1. 导入必要的依赖

```typescript
import { useDispatch } from 'react-redux';
import { RocketLaunch as RocketIcon } from '@mui/icons-material';
import { updateConfig } from '../store/slices/backtestSlice';
```

### 2. 处理函数

```typescript
const handleQuickBacktest = () => {
  if (!stockCode || !stockBasic) {
    setSnackbarMessage('股票信息加载中，请稍候...');
    setSnackbarOpen(true);
    return;
  }

  // 生成回测名称
  const today = new Date().toISOString().split('T')[0];
  const backtestName = `${stockBasic.name} - 回测分析 ${today}`;

  // 计算默认时间范围（近1年）
  const endDate = new Date();
  const startDate = new Date();
  startDate.setFullYear(endDate.getFullYear() - 1);

  // 更新Redux配置
  dispatch(updateConfig({
    name: backtestName,
    startDate: startDate.toISOString().split('T')[0],
    endDate: endDate.toISOString().split('T')[0],
    symbols: [stockCode],
  }));

  // 跳转到回测页面
  navigate('/backtest');
  
  setSnackbarMessage(`已切换到回测页面，股票 ${stockCode} 已预填充`);
  setSnackbarOpen(true);
};
```

### 3. UI组件

```typescript
<Button
  variant="contained"
  color="success"
  size="small"
  startIcon={<RocketIcon />}
  onClick={handleQuickBacktest}
  sx={{ mr: 2 }}
>
  快速回测
</Button>
```

## 🎬 使用流程

### 方式一：从股票详情页开始（推荐）

```
1. 访问任意股票详情页
   例如: /stock/000001.SZ

2. 点击顶部的"快速回测"按钮

3. 自动跳转到回测页面，并预填充：
   - 回测名称: "平安银行 - 回测分析 2024-10-14"
   - 股票代码: 000001.SZ
   - 时间范围: 2023-10-14 至 2024-10-14

4. 选择策略并配置其他参数

5. 点击"开始回测"
```

### 方式二：从策略页面开始

```
1. 访问策略管理页面
   /strategies

2. 点击任意策略的"运行回测"按钮

3. 跳转到回测页面，策略已预选

4. 手动填写股票代码和其他参数

5. 点击"开始回测"
```

## 📊 与网页版功能对比

| 功能点 | 网页版 | React版 | 状态 |
|--------|--------|---------|------|
| 按钮位置 | ✅ K线图区域右上角 | ✅ 页面顶部导航栏 | ✅ |
| 自动填充股票代码 | ✅ | ✅ | ✅ |
| 自动生成回测名称 | ✅ | ✅ | ✅ |
| 默认时间范围 | ✅ 1年 | ✅ 1年 | ✅ |
| 跳转到回测页面 | ✅ | ✅ | ✅ |
| 用户提示 | ✅ | ✅ | ✅ |

## 🎨 UI效果

```
┌─────────────────────────────────────────────────┐
│ ← 股票详情         [🚀 快速回测]  [刷新]       │
├─────────────────────────────────────────────────┤
│                                                  │
│  平安银行                              ¥12.35   │
│  000001.SZ                           ↑+0.15(+1.23%)│
│  [金融] [深圳]                                   │
│                                                  │
└─────────────────────────────────────────────────┘
```

## 💡 设计亮点

### 1. 智能预填充
- 自动提取当前股票信息
- 生成有意义的回测名称
- 设置合理的默认时间范围

### 2. 无缝跳转
- Redux状态管理实现数据传递
- 跳转后立即可用，无需额外操作

### 3. 用户友好
- 清晰的按钮标识（绿色+火箭图标）
- Snackbar提示操作结果
- 防止未加载完成时点击

### 4. 位置优化
- 放在顶部导航栏，更显眼
- 与刷新按钮并列，操作便捷
- 响应式设计，移动端也可用

## 🔄 数据流

```
股票详情页
    ↓
点击"快速回测"
    ↓
提取股票信息
    ↓
dispatch(updateConfig)
    ↓
Redux Store更新
    ↓
navigate('/backtest')
    ↓
回测页面加载
    ↓
从Redux读取配置
    ↓
自动填充表单
```

## 🚀 优势

### 相比手动填写：
1. **节省时间**: 无需复制粘贴股票代码
2. **减少错误**: 自动生成，避免手动输入错误
3. **更流畅**: 一键跳转，无需多步操作

### 相比网页版改进：
1. **位置更显眼**: 顶部导航栏比K线图内更容易发现
2. **状态管理**: Redux确保数据可靠传递
3. **TypeScript**: 类型安全，IDE智能提示

## 📝 代码统计

| 文件 | 新增行数 | 修改内容 |
|------|----------|----------|
| StockDetailPage.tsx | ~40行 | 导入、函数、按钮 |
| backtestSlice.ts | 0 | 已有updateConfig |
| **总计** | **~40行** | **轻量级改动** |

## ✨ 示例场景

### 场景1：技术分析
```
用户查看"平安银行"K线图 
→ 发现MACD金叉信号
→ 点击"快速回测"
→ 选择MACD策略
→ 验证历史效果
```

### 场景2：基本面分析
```
用户查看"贵州茅台"财务数据
→ 发现PE值合理
→ 点击"快速回测"
→ 选择价值投资策略
→ 测试长期收益
```

### 场景3：多股对比
```
用户查看"招商银行"
→ 点击"快速回测"
→ 手动添加"工商银行"、"建设银行"
→ 同时回测银行板块
```

## 🎯 用户反馈预期

- ✅ "太方便了！不用手动输入股票代码"
- ✅ "按钮很显眼，一眼就能看到"
- ✅ "自动生成的名称很合理"
- ✅ "跳转很流畅，信息都预填好了"

## 🔍 测试要点

### 功能测试
- [ ] 点击按钮跳转到回测页面
- [ ] 股票代码正确填充
- [ ] 回测名称自动生成
- [ ] 时间范围设置为1年
- [ ] Snackbar提示正确显示

### 边界测试
- [ ] 股票数据未加载时点击
- [ ] 无效股票代码处理
- [ ] Redux状态更新验证

### UI测试
- [ ] 按钮样式和位置
- [ ] 响应式布局（移动端）
- [ ] 图标显示正确

## 📚 相关文档

- [回测完整实现](./BACKTEST_COMPLETE_IMPLEMENTATION.md)
- [回测集成文档](./BACKTEST_INTEGRATION.md)
- [快速测试指南](./BACKTEST_QUICK_TEST.md)

---

**版本**: v1.0.0  
**更新日期**: 2024-10-14  
**状态**: ✅ 完成并可用  
**参考**: 完全按照网页版实现

