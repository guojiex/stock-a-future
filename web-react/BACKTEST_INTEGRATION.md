# å›æµ‹åŠŸèƒ½é›†æˆ - Web Reactç‰ˆæœ¬

## ğŸ“‹ æ¦‚è¿°

æœ¬æ¬¡æ›´æ–°å®ç°äº†ä»ç­–ç•¥ç®¡ç†é¡µé¢è·³è½¬åˆ°å›æµ‹é¡µé¢çš„å®Œæ•´æµç¨‹ï¼Œå‚è€ƒç½‘é¡µç‰ˆçš„å®ç°æ–¹å¼ï¼Œä½¿ç”¨ Redux ç®¡ç†çŠ¶æ€å’Œ React Router è¿›è¡Œé¡µé¢å¯¼èˆªã€‚

## ğŸ¯ å®ç°çš„åŠŸèƒ½

### 1. Redux çŠ¶æ€ç®¡ç† (`backtestSlice`)

åˆ›å»ºäº†ä¸“é—¨çš„ Redux slice æ¥ç®¡ç†å›æµ‹ç›¸å…³çŠ¶æ€ï¼š

**æ–‡ä»¶**: `web-react/src/store/slices/backtestSlice.ts`

**åŠŸèƒ½**:
- âœ… ç®¡ç†é€‰ä¸­çš„ç­–ç•¥IDåˆ—è¡¨
- âœ… ç®¡ç†å›æµ‹é…ç½®ï¼ˆåˆå§‹èµ„é‡‘ã€æ‰‹ç»­è´¹ã€æ—¥æœŸèŒƒå›´ç­‰ï¼‰
- âœ… æä¾›ç­–ç•¥æ·»åŠ /ç§»é™¤/æ¸…ç©ºæ“ä½œ
- âœ… æä¾›é…ç½®æ›´æ–°æ“ä½œ
- âœ… æä¾›çŠ¶æ€é‡ç½®åŠŸèƒ½

**ä¸»è¦ Actions**:
```typescript
- setSelectedStrategies(ids: string[])  // è®¾ç½®é€‰ä¸­çš„ç­–ç•¥
- addStrategy(id: string)               // æ·»åŠ å•ä¸ªç­–ç•¥
- removeStrategy(id: string)            // ç§»é™¤ç­–ç•¥
- clearStrategies()                     // æ¸…ç©ºæ‰€æœ‰é€‰æ‹©
- updateConfig(config: Partial<Config>) // æ›´æ–°å›æµ‹é…ç½®
- resetBacktest()                       // é‡ç½®æ‰€æœ‰çŠ¶æ€
```

### 2. å›æµ‹é¡µé¢ (`BacktestPage`)

åˆ›å»ºäº†åŸºç¡€çš„å›æµ‹é¡µé¢æ¡†æ¶ï¼š

**æ–‡ä»¶**: `web-react/src/pages/BacktestPage.tsx`

**å½“å‰åŠŸèƒ½**:
- âœ… æ˜¾ç¤ºé€‰ä¸­çš„ç­–ç•¥ä¿¡æ¯
- âœ… è¿”å›ç­–ç•¥åˆ—è¡¨æŒ‰é’®
- âœ… å¼€å‘ä¸­çš„æç¤ºå’Œè¯´æ˜
- âœ… è‡ªåŠ¨è¯»å– Redux ä¸­çš„é€‰ä¸­ç­–ç•¥

**è®¡åˆ’åŠŸèƒ½**:
- ğŸš§ å›æµ‹å‚æ•°é…ç½®è¡¨å•
- ğŸš§ ç­–ç•¥å¤šé€‰ç®¡ç†
- ğŸš§ å›æµ‹æ‰§è¡Œå’Œè¿›åº¦æ¡
- ğŸš§ æƒç›Šæ›²çº¿å›¾è¡¨å±•ç¤º
- ğŸš§ äº¤æ˜“è®°å½•è¯¦æƒ…è¡¨æ ¼
- ğŸš§ ç­–ç•¥æ€§èƒ½å¯¹æ¯”åˆ†æ

### 3. ç­–ç•¥é¡µé¢é›†æˆ

æ›´æ–°äº†ç­–ç•¥ç®¡ç†é¡µé¢ï¼Œå®ç°å®Œæ•´çš„å›æµ‹è·³è½¬ï¼š

**æ–‡ä»¶**: `web-react/src/pages/StrategiesPage.tsx`

**å®ç°æµç¨‹**:
```typescript
handleRunBacktest(strategy) {
  // 1. è®¾ç½®é€‰ä¸­çš„ç­–ç•¥IDåˆ° Redux store
  dispatch(setSelectedStrategies([strategy.id]));
  
  // 2. å¯¼èˆªåˆ°å›æµ‹é¡µé¢
  navigate('/backtest');
}
```

### 4. è·¯ç”±é…ç½®

æ·»åŠ äº†å›æµ‹é¡µé¢çš„è·¯ç”±ï¼š

**æ–‡ä»¶**: `web-react/src/App.tsx`

```typescript
<Route path="backtest" element={<BacktestPage />} />
```

## ğŸ”„ æ•°æ®æµ

```
ç”¨æˆ·ç‚¹å‡»"è¿è¡Œå›æµ‹"æŒ‰é’®
    â†“
StrategiesPage.handleRunBacktest()
    â†“
dispatch(setSelectedStrategies([strategyId]))
    â†“
Redux Store æ›´æ–° backtest.selectedStrategyIds
    â†“
navigate('/backtest')
    â†“
BacktestPage ç»„ä»¶åŠ è½½
    â†“
useAppSelector è¯»å– selectedStrategyIds
    â†“
æ˜¾ç¤ºé€‰ä¸­çš„ç­–ç•¥ä¿¡æ¯
```

## ğŸ“ æ–°å¢æ–‡ä»¶

```
web-react/src/
â”œâ”€â”€ store/
â”‚   â””â”€â”€ slices/
â”‚       â””â”€â”€ backtestSlice.ts          # æ–°å¢: å›æµ‹çŠ¶æ€ç®¡ç†
â”œâ”€â”€ pages/
â”‚   â””â”€â”€ BacktestPage.tsx              # æ–°å¢: å›æµ‹é¡µé¢
â””â”€â”€ BACKTEST_INTEGRATION.md           # æœ¬æ–‡æ¡£
```

## ğŸ”§ ä¿®æ”¹çš„æ–‡ä»¶

```
web-react/src/
â”œâ”€â”€ store/
â”‚   â””â”€â”€ index.ts                      # æ·»åŠ  backtestSlice
â”œâ”€â”€ pages/
â”‚   â””â”€â”€ StrategiesPage.tsx            # å®ç°å›æµ‹è·³è½¬é€»è¾‘
â””â”€â”€ App.tsx                           # æ·»åŠ å›æµ‹è·¯ç”±
```

## ğŸ¨ ç”¨æˆ·ä½“éªŒ

### ç­–ç•¥ç®¡ç†é¡µé¢
1. ç”¨æˆ·ç‚¹å‡»ç­–ç•¥å¡ç‰‡ä¸Šçš„"è¿è¡Œå›æµ‹"æŒ‰é’®
2. ç³»ç»Ÿè‡ªåŠ¨é€‰ä¸­è¯¥ç­–ç•¥
3. é¡µé¢è·³è½¬åˆ°å›æµ‹é¡µé¢

### å›æµ‹é¡µé¢
1. æ˜¾ç¤º"å·²é€‰æ‹© X ä¸ªç­–ç•¥è¿›è¡Œå›æµ‹"çš„æç¤º
2. æ˜¾ç¤ºé€‰ä¸­ç­–ç•¥çš„IDåˆ—è¡¨
3. æä¾›è¿”å›ç­–ç•¥åˆ—è¡¨çš„æŒ‰é’®

## ğŸ†š ä¸ç½‘é¡µç‰ˆå¯¹æ¯”

| åŠŸèƒ½ | ç½‘é¡µç‰ˆ | Reactç‰ˆ(å½“å‰) | è¯´æ˜ |
|------|--------|--------------|------|
| ç­–ç•¥é€‰æ‹©ä¼ é€’ | âœ… | âœ… | ä½¿ç”¨å…¨å±€å˜é‡ vs Redux |
| é¡µé¢è·³è½¬ | Tabåˆ‡æ¢ | è·¯ç”±å¯¼èˆª | ç¬¦åˆå„è‡ªæŠ€æœ¯æ ˆ |
| å¤šç­–ç•¥é€‰æ‹© | âœ… | âœ… | Reduxæ”¯æŒå¤šé€‰ |
| å›æµ‹é…ç½® | âœ… | ğŸš§ | å¾…å®ç° |
| å›æµ‹æ‰§è¡Œ | âœ… | ğŸš§ | å¾…å®ç° |
| ç»“æœå±•ç¤º | âœ… | ğŸš§ | å¾…å®ç° |

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### ä»ç­–ç•¥é¡µé¢è·³è½¬åˆ°å›æµ‹

```typescript
// åœ¨ç­–ç•¥å¡ç‰‡ä¸­ç‚¹å‡»"è¿è¡Œå›æµ‹"æŒ‰é’®
<Button
  variant="contained"
  startIcon={<AssessmentIcon />}
  onClick={() => handleRunBacktest(strategy)}
>
  è¿è¡Œå›æµ‹
</Button>

// è‡ªåŠ¨è·³è½¬åˆ° /backtest å¹¶ä¼ é€’ç­–ç•¥ID
```

### åœ¨å›æµ‹é¡µé¢è¯»å–é€‰ä¸­çš„ç­–ç•¥

```typescript
import { useAppSelector } from '../hooks/redux';

const BacktestPage = () => {
  const selectedStrategyIds = useAppSelector(
    (state) => state.backtest.selectedStrategyIds
  );
  
  // selectedStrategyIds åŒ…å«é€‰ä¸­çš„ç­–ç•¥ID
  console.log('é€‰ä¸­çš„ç­–ç•¥:', selectedStrategyIds);
};
```

### æ‰‹åŠ¨æ·»åŠ ç­–ç•¥åˆ°å›æµ‹

```typescript
import { useDispatch } from 'react-redux';
import { addStrategy } from '../store/slices/backtestSlice';

const dispatch = useDispatch();

// æ·»åŠ å•ä¸ªç­–ç•¥
dispatch(addStrategy('macd_strategy'));

// è®¾ç½®å¤šä¸ªç­–ç•¥
dispatch(setSelectedStrategies(['macd_strategy', 'ma_crossover']));
```

## ğŸ“Š çŠ¶æ€ç»“æ„

```typescript
// Redux State ç»“æ„
{
  backtest: {
    selectedStrategyIds: ['strategy-id-1', 'strategy-id-2'],
    config: {
      name: 'å›æµ‹åç§°',
      startDate: '2024-01-01',
      endDate: '2024-12-31',
      initialCash: 1000000,
      commission: 0.0003,
      symbols: ['000001.SZ', '600000.SH']
    }
  }
}
```

## ğŸ”® åç»­å¼€å‘è®¡åˆ’

### Phase 1: å›æµ‹é…ç½® (P0)
- [ ] å®ç°å›æµ‹å‚æ•°è¡¨å•
  - [ ] å›æµ‹åç§°è¾“å…¥
  - [ ] æ—¶é—´èŒƒå›´é€‰æ‹©å™¨
  - [ ] åˆå§‹èµ„é‡‘è¾“å…¥
  - [ ] æ‰‹ç»­è´¹ç‡é…ç½®
  - [ ] è‚¡ç¥¨ä»£ç åˆ—è¡¨è¾“å…¥
- [ ] è¡¨å•éªŒè¯å’Œé”™è¯¯æç¤º
- [ ] é…ç½®ä¿å­˜åˆ° Redux

### Phase 2: ç­–ç•¥ç®¡ç† (P0)
- [ ] æ˜¾ç¤ºé€‰ä¸­ç­–ç•¥çš„è¯¦ç»†ä¿¡æ¯
- [ ] æ”¯æŒæ·»åŠ æ›´å¤šç­–ç•¥ï¼ˆå¤šé€‰ï¼‰
- [ ] ç­–ç•¥ç§»é™¤åŠŸèƒ½
- [ ] ç­–ç•¥å‚æ•°å±•ç¤º

### Phase 3: å›æµ‹æ‰§è¡Œ (P1)
- [ ] è°ƒç”¨åç«¯å›æµ‹API
- [ ] æ˜¾ç¤ºå›æµ‹è¿›åº¦
- [ ] å®æ—¶æ›´æ–°è¿›åº¦æ¡
- [ ] æ”¯æŒå–æ¶ˆå›æµ‹
- [ ] é”™è¯¯å¤„ç†å’Œé‡è¯•

### Phase 4: ç»“æœå±•ç¤º (P1)
- [ ] æƒç›Šæ›²çº¿å›¾è¡¨ (ECharts)
- [ ] æ€§èƒ½æŒ‡æ ‡å¡ç‰‡
- [ ] äº¤æ˜“è®°å½•è¡¨æ ¼
- [ ] ç­–ç•¥å¯¹æ¯”åˆ†æ
- [ ] æ•°æ®å¯¼å‡ºåŠŸèƒ½

### Phase 5: é«˜çº§åŠŸèƒ½ (P2)
- [ ] å›æµ‹å†å²è®°å½•
- [ ] é…ç½®æ¨¡æ¿ä¿å­˜
- [ ] æ‰¹é‡å›æµ‹
- [ ] å‚æ•°ä¼˜åŒ–å»ºè®®
- [ ] é£é™©åˆ†ææŠ¥å‘Š

## ğŸ› å·²çŸ¥é™åˆ¶

1. **å›æµ‹é¡µé¢åŠŸèƒ½ä¸å®Œæ•´**: å½“å‰ä»…ä¸ºåŸºç¡€æ¡†æ¶ï¼Œæ ¸å¿ƒåŠŸèƒ½å¾…å®ç°
2. **ç­–ç•¥ä¿¡æ¯å±•ç¤ºç®€å•**: ä»…æ˜¾ç¤ºIDï¼Œéœ€è¦å…³è”ç­–ç•¥è¯¦ç»†ä¿¡æ¯
3. **æ— å†å²è®°å½•**: æš‚ä¸æ”¯æŒæŸ¥çœ‹å†å²å›æµ‹ç»“æœ
4. **æ— å‚æ•°éªŒè¯**: é…ç½®è¡¨å•éªŒè¯å¾…å®ç°

## ğŸ’¡ æŠ€æœ¯äº®ç‚¹

1. **Redux é›†ä¸­å¼çŠ¶æ€ç®¡ç†**: æ¸…æ™°çš„çŠ¶æ€æµè½¬ï¼Œæ˜“äºè°ƒè¯•
2. **ç±»å‹å®‰å…¨**: TypeScript æä¾›å®Œæ•´çš„ç±»å‹æ£€æŸ¥
3. **æ¨¡å—åŒ–è®¾è®¡**: æ¯ä¸ªåŠŸèƒ½ç‹¬ç«‹çš„ slice å’Œç»„ä»¶
4. **å¯æ‰©å±•æ¶æ„**: æ˜“äºæ·»åŠ æ–°åŠŸèƒ½å’Œä¼˜åŒ–

## ğŸ“š å‚è€ƒèµ„æ–™

- ç½‘é¡µç‰ˆå›æµ‹æ¨¡å—: `web/static/js/modules/backtest.js`
- ç½‘é¡µç‰ˆç­–ç•¥æ¨¡å—: `web/static/js/modules/strategies.js`
- Redux Toolkitæ–‡æ¡£: https://redux-toolkit.js.org/
- React Routeræ–‡æ¡£: https://reactrouter.com/

---

**æ›´æ–°æ—¥æœŸ**: 2025-10-14
**ç‰ˆæœ¬**: v0.1.0 (åŸºç¡€æ¡†æ¶)
**çŠ¶æ€**: ğŸš§ å¼€å‘ä¸­

