# ğŸ”§ èœ¡çƒ›å›¾æ˜¾ç¤ºé—®é¢˜ä¿®å¤

## ğŸ› é—®é¢˜æè¿°

**ç—‡çŠ¶**ï¼šæ‰€æœ‰Kçº¿éƒ½æ˜¾ç¤ºæˆåå­—æ˜Ÿï¼Œçœ‹ä¸åˆ°èœ¡çƒ›å®ä½“

**åŸå› **ï¼šä¹‹å‰çš„å®ç°é€»è¾‘æœ‰ä¸¥é‡é”™è¯¯
1. âŒ é”™è¯¯åœ°ä½¿ç”¨äº† Bar ç»„ä»¶çš„ `y` å’Œ `height` å‚æ•°
2. âŒ æ²¡æœ‰æ­£ç¡®è®¡ç®—ä»·æ ¼åˆ°å±å¹•åæ ‡çš„æ˜ å°„
3. âŒ èœ¡çƒ›å®ä½“çš„ä½ç½®è®¡ç®—å®Œå…¨é”™è¯¯

## âœ… ä¿®å¤æ–¹æ¡ˆ

### æ ¸å¿ƒåŸç†

Recharts çš„ Bar ç»„ä»¶ä¼šå°† `dataKey="high"` çš„å€¼æ˜ å°„åˆ°å›¾è¡¨åæ ‡ç³»ç»Ÿï¼Œç„¶åé€šè¿‡ `shape` å±æ€§ä¼ é€’ä»¥ä¸‹å‚æ•°ï¼š
- `x`: èœ¡çƒ›çš„å·¦è¾¹ç•ŒXåæ ‡
- `y`: æœ€é«˜ä»·(high)å¯¹åº”çš„Yåæ ‡
- `width`: èœ¡çƒ›çš„å®½åº¦
- `height`: ä»æœ€é«˜ä»·åˆ°æœ€ä½ä»·çš„é«˜åº¦
- `payload`: å½“å‰æ•°æ®ç‚¹çš„å®Œæ•´æ•°æ®

### æ­£ç¡®çš„è®¡ç®—æ–¹æ³•

```typescript
const renderCandlestick = (props: any) => {
  const { x, y, width, height, payload } = props;
  const { open, close, high, low, isUp } = payload;
  
  // å…³é”®ï¼šè®¡ç®—ä»·æ ¼åœ¨Yè½´ä¸Šçš„ç›¸å¯¹ä½ç½®
  const range = high - low;  // ä»·æ ¼èŒƒå›´
  
  // è®¡ç®—å„ä¸ªä»·æ ¼ç‚¹çš„Yåæ ‡
  // high åœ¨æœ€ä¸Šé¢ (y)
  // low åœ¨æœ€ä¸‹é¢ (y + height)
  const openRatio = (high - open) / range;  // openç›¸å¯¹äºhighçš„ä½ç½®
  const closeRatio = (high - close) / range;  // closeç›¸å¯¹äºhighçš„ä½ç½®
  
  const openY = y + height * openRatio;
  const closeY = y + height * closeRatio;
  
  // èœ¡çƒ›å®ä½“çš„é¡¶éƒ¨æ˜¯openå’Œcloseä¸­è¾ƒå°çš„Yå€¼
  const bodyTop = Math.min(openY, closeY);
  const bodyHeight = Math.abs(closeY - openY);
  
  return (
    <g>
      {/* å½±çº¿ï¼šä»highåˆ°low */}
      <line x1={centerX} y1={y} x2={centerX} y2={y + height} />
      
      {/* å®ä½“ï¼šä»openåˆ°close */}
      <rect x={centerX - bodyWidth/2} y={bodyTop} 
            width={bodyWidth} height={bodyHeight} />
    </g>
  );
};
```

### å…³é”®ç‚¹è§£æ

1. **Yè½´åæ ‡ç³»**ï¼š
   ```
   y = 0 (é¡¶éƒ¨) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   â”‚                           â†‘ ä»·æ ¼é«˜
   â”‚ high (æœ€é«˜ä»·)              â”‚
   â”‚ â”œâ”€ open/close              â”‚
   â”‚ â””â”€ close/open              â”‚
   â”‚ low (æœ€ä½ä»·)               â†“ ä»·æ ¼ä½
   y + height (åº•éƒ¨) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   ```

2. **æ¯”ä¾‹è®¡ç®—**ï¼š
   ```typescript
   // å¦‚æœ high = 100, low = 90, open = 95
   range = 100 - 90 = 10
   openRatio = (100 - 95) / 10 = 0.5
   // æ‰€ä»¥ open åœ¨ä¸­é—´ä½ç½®
   openY = y + height * 0.5
   ```

3. **å®ä½“æ–¹å‘**ï¼š
   ```typescript
   // ä¸Šæ¶¨ (close > open)
   // openåœ¨ä¸‹ï¼Œcloseåœ¨ä¸Š
   bodyTop = closeY (è¾ƒå°çš„Yå€¼)
   
   // ä¸‹è·Œ (close < open)
   // openåœ¨ä¸Šï¼Œcloseåœ¨ä¸‹
   bodyTop = openY (è¾ƒå°çš„Yå€¼)
   ```

## ğŸ¨ è§†è§‰æ•ˆæœ

### ä¿®å¤å‰
```
æ‰€æœ‰èœ¡çƒ›éƒ½æ˜¯è¿™æ ·ï¼š
   |     â† åªæœ‰ä¸€æ¡ç«–çº¿ï¼ˆåå­—æ˜Ÿï¼‰
   |
```

### ä¿®å¤å
```
æ­£å¸¸çš„èœ¡çƒ›å›¾ï¼š

ä¸Šæ¶¨ï¼ˆç»¿è‰²ï¼‰      ä¸‹è·Œï¼ˆçº¢è‰²ï¼‰
   â”‚                 â”‚
  â”Œâ”´â”               â”Œâ”´â”
  â”‚â–ˆâ”‚  â† å®ä½“       â”‚â–ˆâ”‚  â† å®ä½“
  â””â”¬â”˜               â””â”¬â”˜
   â”‚                 â”‚
```

## ğŸ“Š å®é™…æ•ˆæœ

ç°åœ¨æ¯æ ¹èœ¡çƒ›æ­£ç¡®æ˜¾ç¤ºï¼š
- âœ… **å½±çº¿**ï¼šä»å½“æ—¥æœ€é«˜ä»·åˆ°æœ€ä½ä»·çš„ç»†çº¿
- âœ… **å®ä½“**ï¼šå¼€ç›˜ä»·å’Œæ”¶ç›˜ä»·ä¹‹é—´çš„çŸ©å½¢
- âœ… **é¢œè‰²**ï¼šç»¿è‰²è¡¨ç¤ºä¸Šæ¶¨ï¼Œçº¢è‰²è¡¨ç¤ºä¸‹è·Œ
- âœ… **å®½åº¦**ï¼šè‡ªåŠ¨é€‚åº”æ•°æ®å¯†åº¦
- âœ… **åå­—æ˜Ÿ**ï¼šå½“å¼€ç›˜ä»·â‰ˆæ”¶ç›˜ä»·æ—¶ï¼Œå®ä½“æ˜¾ç¤ºä¸ºç»†çº¿

## ğŸ” è°ƒè¯•å»ºè®®

å¦‚æœèœ¡çƒ›å›¾ä»ç„¶æ˜¾ç¤ºå¼‚å¸¸ï¼Œæ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š

1. **æ•°æ®æ ¼å¼**ï¼š
   ```typescript
   // ç¡®ä¿æ•°æ®åŒ…å«å®Œæ•´çš„OHLC
   {
     open: 15.50,   // å¼€ç›˜ä»·
     high: 16.00,   // æœ€é«˜ä»·
     low: 15.30,    // æœ€ä½ä»·
     close: 15.80,  // æ”¶ç›˜ä»·
     isUp: true     // close >= open
   }
   ```

2. **ä»·æ ¼èŒƒå›´**ï¼š
   ```typescript
   // ç¡®ä¿ high >= open, close >= low
   // ç¡®ä¿ range = high - low > 0
   ```

3. **Yè½´domain**ï¼š
   ```typescript
   // ç»™ä»·æ ¼ç•™å‡ºä¸€äº›ç©ºé—´
   domain={[
     (dataMin: number) => dataMin * 0.98,
     (dataMax: number) => dataMax * 1.02
   ]}
   ```

## ğŸ¯ æµ‹è¯•ç”¨ä¾‹

### 1. å¤§é˜³çº¿ï¼ˆå¼ºçƒˆä¸Šæ¶¨ï¼‰
```typescript
{
  open: 10.00,
  close: 11.00,  // close >> open
  high: 11.10,
  low: 9.90
}
// é¢„æœŸï¼šé•¿ç»¿è‰²å®ä½“ï¼ŒçŸ­å½±çº¿
```

### 2. å¤§é˜´çº¿ï¼ˆå¼ºçƒˆä¸‹è·Œï¼‰
```typescript
{
  open: 11.00,
  close: 10.00,  // close << open
  high: 11.10,
  low: 9.90
}
// é¢„æœŸï¼šé•¿çº¢è‰²å®ä½“ï¼ŒçŸ­å½±çº¿
```

### 3. åå­—æ˜Ÿï¼ˆçŠ¹è±«ä¸å†³ï¼‰
```typescript
{
  open: 10.50,
  close: 10.52,  // close â‰ˆ open
  high: 10.80,
  low: 10.20
}
// é¢„æœŸï¼šå¾ˆçŸ­çš„å®ä½“ï¼Œé•¿å½±çº¿
```

### 4. é”¤å­çº¿ï¼ˆåº•éƒ¨åè½¬ï¼‰
```typescript
{
  open: 10.45,
  close: 10.50,  // å°å®ä½“
  high: 10.60,   // çŸ­ä¸Šå½±
  low: 10.00     // é•¿ä¸‹å½±
}
// é¢„æœŸï¼šå°å®ä½“åœ¨ä¸Šæ–¹ï¼Œé•¿ä¸‹å½±çº¿
```

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

1. **ç¦ç”¨åŠ¨ç”»**ï¼š`isAnimationActive={false}` - æå‡æ€§èƒ½
2. **æœ€å°å°ºå¯¸**ï¼šç¡®ä¿å®ä½“å’Œå½±çº¿æœ‰æœ€å°å¯è§å®½åº¦
3. **å“åº”å¼å®½åº¦**ï¼šæ ¹æ®æ•°æ®ç‚¹æ•°é‡è‡ªåŠ¨è°ƒæ•´èœ¡çƒ›å®½åº¦

## ğŸ“ ä»£ç å¯¹æ¯”

### é”™è¯¯çš„å®ç°ï¼ˆä¹‹å‰ï¼‰
```typescript
// âŒ é”™è¯¯ï¼šç›´æ¥ä½¿ç”¨yå’Œheightï¼Œæ²¡æœ‰è€ƒè™‘OHLCçš„å…³ç³»
<rect
  y={y + (height - actualBodyHeight) * (high - bodyTop) / (high - low)}
  height={actualBodyHeight}
/>
```

### æ­£ç¡®çš„å®ç°ï¼ˆç°åœ¨ï¼‰
```typescript
// âœ… æ­£ç¡®ï¼šåŸºäºrangeæ¯”ä¾‹è®¡ç®—æ¯ä¸ªä»·æ ¼çš„ä½ç½®
const range = high - low;
const openY = y + height * (high - open) / range;
const closeY = y + height * (high - close) / range;
const bodyTop = Math.min(openY, closeY);
const bodyHeight = Math.abs(closeY - openY);
```

## ğŸ‰ ç»“æœ

ç°åœ¨åˆ·æ–°é¡µé¢ï¼Œä½ ä¼šçœ‹åˆ°ï¼š
- âœ… å®Œæ•´çš„èœ¡çƒ›å®ä½“
- âœ… æ¸…æ™°çš„ä¸Šä¸‹å½±çº¿
- âœ… æ­£ç¡®çš„æ¶¨è·Œé¢œè‰²
- âœ… ä¸“ä¸šçš„Kçº¿å›¾æ•ˆæœ

ä¸å†æ˜¯"æ‰€æœ‰èœ¡çƒ›éƒ½æ˜¯åå­—æ˜Ÿ"äº†ï¼ğŸŠ

