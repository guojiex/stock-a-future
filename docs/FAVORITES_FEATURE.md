# 收藏股票功能文档

## 功能概述

收藏股票功能允许用户将感兴趣的股票及其对应的时间范围保存下来，方便快速访问和查看历史数据。

## 主要特性

- ⭐ **收藏股票**：保存股票代码、名称和查询时间范围
- 📊 **快速查看**：点击收藏列表中的股票快速加载K线图
- 🕒 **时间记忆**：自动恢复收藏时设置的开始和结束日期
- 💾 **持久化存储**：数据保存在服务器端，重启后不丢失
- 🔄 **实时同步**：收藏状态实时更新

## 使用方法

### 1. 添加收藏

1. 在股票搜索框中输入或选择股票
2. 设置想要的开始日期和结束日期
3. 点击"⭐ 收藏"按钮
4. 系统会保存当前的股票和时间范围

### 2. 查看收藏列表

- 收藏区域会显示所有已收藏的股票
- 每个收藏项包含：
  - 股票名称和代码
  - 收藏时的时间范围
  - 收藏日期
  - 操作按钮

### 3. 加载收藏的股票

- **方法一**：直接点击收藏项
- **方法二**：点击收藏项的"📈 查看"按钮

加载时会自动：
- 设置股票代码到搜索框
- 恢复收藏时的时间范围
- 加载对应的K线图

### 4. 删除收藏

- 点击收藏项的"🗑️ 删除"按钮
- 确认删除操作

## API 端点

### 获取收藏列表
```http
GET /api/v1/favorites
```

### 添加收藏
```http
POST /api/v1/favorites
Content-Type: application/json

{
  "ts_code": "000001.SZ",
  "name": "平安银行",
  "start_date": "20240101",
  "end_date": "20241231"
}
```

### 删除收藏
```http
DELETE /api/v1/favorites/{id}
```

### 更新收藏时间范围
```http
PUT /api/v1/favorites/{id}
Content-Type: application/json

{
  "start_date": "20240201",
  "end_date": "20241130"
}
```

### 检查股票是否已收藏
```http
GET /api/v1/favorites/check/{stock_code}
```

## 数据存储

收藏数据保存在 `data/favorites.json` 文件中，格式如下：

```json
[
  {
    "id": "abc123def456",
    "ts_code": "000001.SZ",
    "name": "平安银行",
    "start_date": "20240101",
    "end_date": "20241231",
    "created_at": "2024-01-15T10:30:00Z",
    "updated_at": "2024-01-15T10:30:00Z"
  }
]
```

## 界面说明

### 收藏按钮状态

- **⭐ 收藏**：未收藏状态，可以点击收藏
- **⭐ 已收藏**：已收藏状态，按钮禁用

### 收藏列表

- **收藏项高亮**：点击的收藏项会高亮显示
- **操作按钮**：鼠标悬停时显示操作按钮
- **空状态**：没有收藏时显示提示信息

## 技术实现

### 后端（Go）

- **数据模型**：`FavoriteStock` 结构体
- **服务层**：`FavoriteService` 处理业务逻辑
- **存储层**：JSON文件持久化
- **API层**：RESTful API 端点

### 前端（JavaScript）

- **服务层**：`FavoritesService` 处理API调用
- **UI模块**：`FavoritesModule` 处理界面交互
- **事件集成**：与主应用事件系统集成
- **样式**：响应式CSS设计

## 错误处理

- **重复收藏**：防止同一股票重复收藏
- **数据验证**：检查股票代码和名称格式
- **网络错误**：友好的错误提示
- **文件权限**：自动创建数据目录

## 注意事项

1. 收藏功能需要服务器运行才能使用
2. 数据文件位于 `data/favorites.json`
3. 删除操作不可恢复，请谨慎操作
4. 时间格式支持 YYYYMMDD 和 YYYY-MM-DD
5. 收藏数量没有限制，但建议适量使用

## 故障排除

### 收藏按钮无响应
- 检查股票代码是否正确
- 确认服务器是否正常运行
- 查看浏览器控制台错误信息

### 收藏列表不显示
- 检查网络连接
- 确认API端点是否可访问
- 查看服务器日志

### 数据丢失
- 检查 `data/favorites.json` 文件是否存在
- 确认文件权限是否正确
- 查看服务器启动日志
