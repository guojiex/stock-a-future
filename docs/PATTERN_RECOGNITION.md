# 图形识别功能使用指南

## 概述

Stock-A-Future 现在支持经典量价图形识别功能，能够自动识别股票K线图中的各种技术分析模式，为投资决策提供参考。

## 支持的图形模式

### 蜡烛图模式 (Candlestick Patterns)

#### 1. 双响炮 (Double Cannon)
- **描述**: 连续两根大阳线，成交量放大
- **信号**: 买入信号
- **识别条件**:
  - 第一根K线涨幅 > 2%
  - 第二根K线涨幅 > 3%
  - 第二根成交量是第一根的1.5倍以上
  - 两根K线都是阳线

#### 2. 红三兵 (Red Three Soldiers)
- **描述**: 连续三根上涨K线，每根K线都在前一根K线的实体范围内开盘
- **信号**: 买入信号
- **识别条件**:
  - 三根K线都是阳线
  - 开盘价在前一根K线的实体范围内
  - 平均涨幅 > 1.5%

#### 3. 乌云盖顶 (Dark Cloud Cover)
- **描述**: 大阳线后跟大阴线，阴线开盘价高于前一根阳线的最高价
- **信号**: 卖出信号
- **识别条件**:
  - 前一根K线涨幅 > 2%
  - 当前K线跌幅 > 2%
  - 当前开盘价高于前一根最高价
  - 当前收盘价低于前一根实体中点

#### 4. 锤子线 (Hammer)
- **描述**: 下影线很长，实体较小，上影线很短或没有
- **信号**: 买入信号
- **识别条件**:
  - 下影线长度 > 实体长度的2倍
  - 上影线长度 < 实体长度的0.5倍
  - 实体长度 > 0

#### 5. 启明星 (Morning Star)
- **描述**: 下跌趋势中的反转信号
- **信号**: 买入信号
- **识别条件**:
  - 第一根：大阴线（跌幅 > 2%）
  - 第二根：小实体K线（实体 < 1%）
  - 第三根：大阳线（涨幅 > 2%）
  - 前5天处于下跌趋势

#### 6. 黄昏星 (Evening Star)
- **描述**: 上涨趋势中的反转信号
- **信号**: 卖出信号
- **识别条件**:
  - 第一根：大阳线（涨幅 > 2%）
  - 第二根：小实体K线（实体 < 1%）
  - 第三根：大阴线（跌幅 > 2%）
  - 前5天处于上涨趋势

### 量价图形 (Volume-Price Patterns)

#### 1. 量价齐升 (Volume-Price Rise)
- **描述**: 价格和成交量同时上涨
- **信号**: 买入信号
- **识别条件**:
  - 价格上涨 > 1%
  - 成交量增加 > 20%

#### 2. 量价背离 (Volume-Price Divergence)
- **描述**: 价格与成交量变化不一致
- **信号**: 根据背离类型判断
- **识别条件**:
  - 顶背离：价格上涨 > 1% 且成交量下降 > 20%
  - 底背离：价格下跌 > 1% 且成交量上升 > 20%

#### 3. 放量突破 (Volume Breakout)
- **描述**: 价格突破重要阻力位，成交量明显放大
- **信号**: 买入信号
- **识别条件**:
  - 价格突破20日均线
  - 成交量是20日平均成交量的2倍以上
  - 突破幅度 > 1%

## API 接口

### 1. 识别图形模式
```http
GET /api/v1/patterns/recognize?ts_code=000001.SZ&start_date=20240101&end_date=20240131
```

**参数**:
- `ts_code`: 股票代码（必需）
- `start_date`: 开始日期（可选，默认20240101）
- `end_date`: 结束日期（可选，默认20241231）

**响应示例**:
```json
{
  "success": true,
  "data": [
    {
      "ts_code": "000001.SZ",
      "trade_date": "20240103",
      "candlestick": [
        {
          "pattern": "双响炮",
          "signal": "BUY",
          "confidence": 85.5,
          "description": "连续两根大阳线，成交量放大，强势上涨信号",
          "strength": "STRONG",
          "volume": 2500,
          "price_change": 0.4
        }
      ],
      "volume_price": [],
      "combined_signal": "BUY",
      "overall_confidence": 85.5,
      "risk_level": "LOW"
    }
  ]
}
```

### 2. 搜索指定图形模式
```http
POST /api/v1/patterns/search
```

**请求体**:
```json
{
  "ts_code": "000001.SZ",
  "start_date": "20240101",
  "end_date": "20240131",
  "patterns": ["双响炮", "红三兵"],
  "min_confidence": 70.0
}
```

### 3. 获取图形模式摘要
```http
GET /api/v1/patterns/summary?ts_code=000001.SZ&days=30
```

**参数**:
- `ts_code`: 股票代码（必需）
- `days`: 统计天数（可选，默认30）

### 4. 获取最近的图形信号
```http
GET /api/v1/patterns/recent?ts_code=000001.SZ&limit=10
```

**参数**:
- `ts_code`: 股票代码（必需）
- `limit`: 返回数量限制（可选，默认10）

### 5. 获取可用的图形模式列表
```http
GET /api/v1/patterns/available
```

### 6. 获取图形模式统计信息
```http
GET /api/v1/patterns/statistics?ts_code=000001.SZ&start_date=20240101&end_date=20240131
```

## 置信度和信号强度

### 置信度 (Confidence)
- **范围**: 0-100
- **计算方式**: 基于价格变化、成交量变化和量比综合计算
- **权重分配**:
  - 价格变化: 40%
  - 成交量变化: 30%
  - 量比: 30%

### 信号强度 (Strength)
- **STRONG**: 置信度 ≥ 80
- **MEDIUM**: 置信度 60-79
- **WEAK**: 置信度 < 60

### 风险等级 (Risk Level)
- **LOW**: 置信度 ≥ 80
- **MEDIUM**: 置信度 60-79
- **HIGH**: 置信度 < 60

## 使用建议

### 1. 图形识别不是万能的
- 图形识别提供技术分析参考，不能完全依赖
- 需要结合基本面分析、市场环境等因素
- 建议在多个时间周期下验证信号

### 2. 置信度的重要性
- 高置信度（≥80）的信号更可靠
- 低置信度信号需要更多验证
- 多个图形模式同时出现时，综合置信度更高

### 3. 风险控制
- 设置止损位，控制单笔交易风险
- 不要因为图形信号而忽视资金管理
- 在趋势明确的市场中，图形信号更有效

### 4. 实战应用
- 结合其他技术指标（MACD、RSI、布林带等）
- 关注成交量的配合
- 在关键支撑阻力位附近寻找图形信号

## 测试

运行测试以验证图形识别功能：

```bash
cd internal/indicators
go test -v
```

## 注意事项

1. **数据质量**: 图形识别的准确性依赖于历史数据的质量
2. **市场环境**: 不同市场环境下，同一图形的有效性可能不同
3. **时间周期**: 图形在不同时间周期下的意义可能不同
4. **假信号**: 任何技术分析都可能产生假信号，需要综合判断

## 扩展功能

未来版本计划添加：
- 更多经典图形模式
- 自定义图形识别规则
- 图形模式的历史成功率统计
- 实时图形识别提醒
- 图形模式的可视化展示
