<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¨¡å—åŒ–é‡æ„æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .info { color: #17a2b8; }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            background-color: #f8f9fa;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª Stock-A-Future æ¨¡å—åŒ–é‡æ„æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>æ¨¡å—åŠ è½½æµ‹è¯•</h2>
        <button onclick="testModuleLoading()">æµ‹è¯•æ¨¡å—åŠ è½½</button>
        <div id="moduleTestResult" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>ç±»å®ä¾‹åŒ–æµ‹è¯•</h2>
        <button onclick="testClassInstantiation()">æµ‹è¯•ç±»å®ä¾‹åŒ–</button>
        <div id="classTestResult" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>åŠŸèƒ½æµ‹è¯•</h2>
        <button onclick="testFunctionality()">æµ‹è¯•åŸºæœ¬åŠŸèƒ½</button>
        <div id="functionalityTestResult" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>åº”ç”¨åˆå§‹åŒ–æµ‹è¯•</h2>
        <button onclick="testAppInitialization()">æµ‹è¯•åº”ç”¨åˆå§‹åŒ–</button>
        <div id="appTestResult" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>æµ‹è¯•ç»“æœæ±‡æ€»</h2>
        <div id="summaryResult" class="test-result"></div>
    </div>

    <!-- åŠ è½½æ‰€æœ‰æ¨¡å— -->
    <script src="js/core/client.js"></script>
    <script src="js/services/api.js"></script>
    <script src="js/modules/charts.js"></script>
    <script src="js/modules/stockSearch.js"></script>
    <script src="js/modules/config.js"></script>
    <script src="js/modules/display.js"></script>
    <script src="js/modules/events.js"></script>
    <script src="js/utils/helpers.js"></script>
    <script src="js/main.js"></script>

    <script>
        let testResults = {};

        function logResult(testName, success, message) {
            const status = success ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥';
            const color = success ? 'success' : 'error';
            testResults[testName] = success;
            
            console.log(`${status} ${testName}: ${message}`);
            return `<div class="${color}">${status} ${testName}: ${message}</div>`;
        }

        function testModuleLoading() {
            const resultDiv = document.getElementById('moduleTestResult');
            let results = '<h3>æ¨¡å—åŠ è½½æµ‹è¯•ç»“æœ:</h3>';
            
            // æµ‹è¯•æ ¸å¿ƒæ¨¡å—
            if (typeof StockAFutureClient !== 'undefined') {
                results += logResult('StockAFutureClient', true, 'æ ¸å¿ƒå®¢æˆ·ç«¯ç±»åŠ è½½æˆåŠŸ');
            } else {
                results += logResult('StockAFutureClient', false, 'æ ¸å¿ƒå®¢æˆ·ç«¯ç±»åŠ è½½å¤±è´¥');
            }

            if (typeof ApiService !== 'undefined') {
                results += logResult('ApiService', true, 'APIæœåŠ¡ç±»åŠ è½½æˆåŠŸ');
            } else {
                results += logResult('ApiService', false, 'APIæœåŠ¡ç±»åŠ è½½å¤±è´¥');
            }

            if (typeof ChartsModule !== 'undefined') {
                results += logResult('ChartsModule', true, 'å›¾è¡¨æ¨¡å—ç±»åŠ è½½æˆåŠŸ');
            } else {
                results += logResult('ChartsModule', false, 'å›¾è¡¨æ¨¡å—ç±»åŠ è½½å¤±è´¥');
            }

            if (typeof StockSearchModule !== 'undefined') {
                results += logResult('StockSearchModule', true, 'è‚¡ç¥¨æœç´¢æ¨¡å—ç±»åŠ è½½æˆåŠŸ');
            } else {
                results += logResult('StockSearchModule', false, 'è‚¡ç¥¨æœç´¢æ¨¡å—ç±»åŠ è½½å¤±è´¥');
            }

            if (typeof ConfigModule !== 'undefined') {
                results += logResult('ConfigModule', true, 'é…ç½®ç®¡ç†æ¨¡å—ç±»åŠ è½½æˆåŠŸ');
            } else {
                results += logResult('ConfigModule', false, 'é…ç½®ç®¡ç†æ¨¡å—ç±»åŠ è½½å¤±è´¥');
            }

            if (typeof DisplayModule !== 'undefined') {
                results += logResult('DisplayModule', true, 'æ•°æ®å±•ç¤ºæ¨¡å—ç±»åŠ è½½æˆåŠŸ');
            } else {
                results += logResult('DisplayModule', false, 'æ•°æ®å±•ç¤ºæ¨¡å—ç±»åŠ è½½å¤±è´¥');
            }

            if (typeof EventsModule !== 'undefined') {
                results += logResult('EventsModule', true, 'äº‹ä»¶å¤„ç†æ¨¡å—ç±»åŠ è½½æˆåŠŸ');
            } else {
                results += logResult('EventsModule', false, 'äº‹ä»¶å¤„ç†æ¨¡å—ç±»åŠ è½½å¤±è´¥');
            }

            if (typeof Helpers !== 'undefined') {
                results += logResult('Helpers', true, 'å·¥å…·å‡½æ•°ç±»åŠ è½½æˆåŠŸ');
            } else {
                results += logResult('Helpers', false, 'å·¥å…·å‡½æ•°ç±»åŠ è½½å¤±è´¥');
            }

            if (typeof StockAFutureApp !== 'undefined') {
                results += logResult('StockAFutureApp', true, 'ä¸»åº”ç”¨ç±»åŠ è½½æˆåŠŸ');
            } else {
                results += logResult('StockAFutureApp', false, 'ä¸»åº”ç”¨ç±»åŠ è½½å¤±è´¥');
            }

            resultDiv.innerHTML = results;
        }

        function testClassInstantiation() {
            const resultDiv = document.getElementById('classTestResult');
            let results = '<h3>ç±»å®ä¾‹åŒ–æµ‹è¯•ç»“æœ:</h3>';
            
            try {
                // æµ‹è¯•æ ¸å¿ƒå®¢æˆ·ç«¯å®ä¾‹åŒ–
                const client = new StockAFutureClient();
                results += logResult('StockAFutureClientå®ä¾‹åŒ–', true, 'æ ¸å¿ƒå®¢æˆ·ç«¯å®ä¾‹åŒ–æˆåŠŸ');
                
                // æµ‹è¯•APIæœåŠ¡å®ä¾‹åŒ–
                const apiService = new ApiService(client);
                results += logResult('ApiServiceå®ä¾‹åŒ–', true, 'APIæœåŠ¡å®ä¾‹åŒ–æˆåŠŸ');
                
                // æµ‹è¯•å›¾è¡¨æ¨¡å—å®ä¾‹åŒ–
                const chartsModule = new ChartsModule(client);
                results += logResult('ChartsModuleå®ä¾‹åŒ–', true, 'å›¾è¡¨æ¨¡å—å®ä¾‹åŒ–æˆåŠŸ');
                
                // æµ‹è¯•å…¶ä»–æ¨¡å—å®ä¾‹åŒ–
                const displayModule = new DisplayModule(client, chartsModule);
                results += logResult('DisplayModuleå®ä¾‹åŒ–', true, 'æ•°æ®å±•ç¤ºæ¨¡å—å®ä¾‹åŒ–æˆåŠŸ');
                
                const eventsModule = new EventsModule(client, apiService, displayModule);
                results += logResult('EventsModuleå®ä¾‹åŒ–', true, 'äº‹ä»¶å¤„ç†æ¨¡å—å®ä¾‹åŒ–æˆåŠŸ');
                
                const stockSearchModule = new StockSearchModule(client, apiService);
                results += logResult('StockSearchModuleå®ä¾‹åŒ–', true, 'è‚¡ç¥¨æœç´¢æ¨¡å—å®ä¾‹åŒ–æˆåŠŸ');
                
                const configModule = new ConfigModule(client);
                results += logResult('ConfigModuleå®ä¾‹åŒ–', true, 'é…ç½®ç®¡ç†æ¨¡å—å®ä¾‹åŒ–æˆåŠŸ');
                
            } catch (error) {
                results += logResult('ç±»å®ä¾‹åŒ–', false, `å®ä¾‹åŒ–è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯: ${error.message}`);
            }

            resultDiv.innerHTML = results;
        }

        function testFunctionality() {
            const resultDiv = document.getElementById('functionalityTestResult');
            let results = '<h3>åŠŸèƒ½æµ‹è¯•ç»“æœ:</h3>';
            
            try {
                // æµ‹è¯•å·¥å…·å‡½æ•°
                const testNumber = 1234567.89;
                const formattedNumber = Helpers.formatNumber(testNumber);
                if (formattedNumber === '1,234,567.89') {
                    results += logResult('æ•°å­—æ ¼å¼åŒ–', true, 'æ•°å­—æ ¼å¼åŒ–åŠŸèƒ½æ­£å¸¸');
                } else {
                    results += logResult('æ•°å­—æ ¼å¼åŒ–', false, 'æ•°å­—æ ¼å¼åŒ–åŠŸèƒ½å¼‚å¸¸');
                }

                // æµ‹è¯•è´§å¸æ ¼å¼åŒ–
                const formattedCurrency = Helpers.formatCurrency(testNumber);
                if (formattedCurrency.includes('Â¥1,234,567.89')) {
                    results += logResult('è´§å¸æ ¼å¼åŒ–', true, 'è´§å¸æ ¼å¼åŒ–åŠŸèƒ½æ­£å¸¸');
                } else {
                    results += logResult('è´§å¸æ ¼å¼åŒ–', false, 'è´§å¸æ ¼å¼åŒ–åŠŸèƒ½å¼‚å¸¸');
                }

                // æµ‹è¯•ç™¾åˆ†æ¯”æ ¼å¼åŒ–
                const testPercent = 0.1234;
                const formattedPercent = Helpers.formatPercentage(testPercent);
                if (formattedPercent === '12.34%') {
                    results += logResult('ç™¾åˆ†æ¯”æ ¼å¼åŒ–', true, 'ç™¾åˆ†æ¯”æ ¼å¼åŒ–åŠŸèƒ½æ­£å¸¸');
                } else {
                    results += logResult('ç™¾åˆ†æ¯”æ ¼å¼åŒ–', false, 'ç™¾åˆ†æ¯”æ ¼å¼åŒ–åŠŸèƒ½å¼‚å¸¸');
                }

                // æµ‹è¯•é˜²æŠ–å‡½æ•°
                let callCount = 0;
                const debouncedFunc = Helpers.debounce(() => callCount++, 100);
                debouncedFunc();
                debouncedFunc();
                debouncedFunc();
                
                setTimeout(() => {
                    if (callCount === 1) {
                        results += logResult('é˜²æŠ–å‡½æ•°', true, 'é˜²æŠ–åŠŸèƒ½æ­£å¸¸');
                    } else {
                        results += logResult('é˜²æŠ–å‡½æ•°', false, 'é˜²æŠ–åŠŸèƒ½å¼‚å¸¸');
                    }
                }, 200);

            } catch (error) {
                results += logResult('åŠŸèƒ½æµ‹è¯•', false, `åŠŸèƒ½æµ‹è¯•è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯: ${error.message}`);
            }

            resultDiv.innerHTML = results;
        }

        function testAppInitialization() {
            const resultDiv = document.getElementById('appTestResult');
            let results = '<h3>åº”ç”¨åˆå§‹åŒ–æµ‹è¯•ç»“æœ:</h3>';
            
            try {
                // ç­‰å¾…åº”ç”¨åˆå§‹åŒ–
                setTimeout(() => {
                    if (window.stockApp) {
                        results += logResult('åº”ç”¨å®ä¾‹', true, 'åº”ç”¨å®ä¾‹åˆ›å»ºæˆåŠŸ');
                        
                        // æµ‹è¯•å„ä¸ªæ¨¡å—çš„è·å–
                        const client = window.stockApp.getClient();
                        if (client) {
                            results += logResult('å®¢æˆ·ç«¯è·å–', true, 'å®¢æˆ·ç«¯æ¨¡å—è·å–æˆåŠŸ');
                        } else {
                            results += logResult('å®¢æˆ·ç«¯è·å–', false, 'å®¢æˆ·ç«¯æ¨¡å—è·å–å¤±è´¥');
                        }

                        const apiService = window.stockApp.getApiService();
                        if (apiService) {
                            results += logResult('APIæœåŠ¡è·å–', true, 'APIæœåŠ¡æ¨¡å—è·å–æˆåŠŸ');
                        } else {
                            results += logResult('APIæœåŠ¡è·å–', false, 'APIæœåŠ¡æ¨¡å—è·å–å¤±è´¥');
                        }

                        resultDiv.innerHTML = results;
                    } else {
                        results += logResult('åº”ç”¨å®ä¾‹', false, 'åº”ç”¨å®ä¾‹åˆ›å»ºå¤±è´¥');
                        resultDiv.innerHTML = results;
                    }
                }, 1000);

            } catch (error) {
                results += logResult('åº”ç”¨åˆå§‹åŒ–', false, `åº”ç”¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯: ${error.message}`);
                resultDiv.innerHTML = results;
            }
        }

        // è‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.addEventListener('load', () => {
            setTimeout(() => {
                testModuleLoading();
                testClassInstantiation();
                testFunctionality();
                testAppInitialization();
                
                // æ˜¾ç¤ºæµ‹è¯•ç»“æœæ±‡æ€»
                setTimeout(() => {
                    const summaryDiv = document.getElementById('summaryResult');
                    const totalTests = Object.keys(testResults).length;
                    const passedTests = Object.values(testResults).filter(Boolean).length;
                    const failedTests = totalTests - passedTests;
                    
                    const summary = `
                        <h3>æµ‹è¯•ç»“æœæ±‡æ€»:</h3>
                        <div class="success">æ€»æµ‹è¯•æ•°: ${totalTests}</div>
                        <div class="success">é€šè¿‡: ${passedTests}</div>
                        <div class="${failedTests > 0 ? 'error' : 'success'}">å¤±è´¥: ${failedTests}</div>
                        <div class="info">æˆåŠŸç‡: ${((passedTests / totalTests) * 100).toFixed(1)}%</div>
                    `;
                    
                    summaryDiv.innerHTML = summary;
                }, 2000);
            }, 500);
        });
    </script>
</body>
</html>
